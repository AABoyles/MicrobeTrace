!function(e,r){"function"==typeof define&&define.amd?define([],(function(){return e.bioseq=r()})):"object"==typeof module&&module.exports?module.exports=r():e.bioseq=r()}("undefined"!=typeof self?self:this,(function(){"use strict";var e={makeIntArray:function(e,r,n){var t=r<=16?new Int16Array(e):new Int32Array(e),o=r<=8?new Int8Array(e):t,a="undefined"!=typeof Int8Array,f=a?o:[];if(!a||0!==n&&void 0!==n)for(var u=0;u<e;u++)f[u]=n;return f},makeAlphabetMap:function(r,n){for(var t=e.makeIntArray(256,8,n),o=r.toLowerCase(),a=0;a<r.length;a++)t[r.charCodeAt(a)]=a,t[o.charCodeAt(a)]=a;return t}};return e.nt5=e.makeAlphabetMap("ACGT",4),e.nac=e.makeAlphabetMap("ACGTURYMKWSBDHVN",16),e.aac=e.makeAlphabetMap("ARNDCQEGHILKMFPSTWYVBZX",32),e.align=function(r,n,t,o,a,f,u){void 0===t&&(t=!0),void 0===o&&(o=[1,-1]),void 0===a&&(a=[-1,-1]),null==u&&(u=e.nt5);var l=e.bsg_enc_seq(r,u),i=e.gen_query_profile(n,o,u),s=i[0].length,g=s>l.length?s:l.length;f=null==f||f<0?g:f;var c,h,v=l.reference>s?l.reference-s:s-l.reference;f=f>v?f:v,"number"==typeof a?(c=0,h=a>0?a:-a):(c=a[0]>0?a[0]:-a[0],h=a[1]>0?a[1]:-a[1]);var p,I=c+h,A=[],b=[],m=[],N=0,d=-1,y=-1;if(t)for(var _=0;_<=s;++_)A[_]=b[_]=0;else{A[0]=0,b[0]=-I-c;for(_=1;_<=s;++_)_>=f?A[_]=b[_]=Number.NEGATIVE_INFINITY:(A[_]=-(I+h*(_-1)),b[_]=-(I+I+h*_))}for(var T=0;T<l.length;++T){var E,C=0,G=0,q=0,M=-1,k=i[l[T]];E=m[T]=[];var V=T>f?T-f:0,Y=T+f+1<s?T+f+1:s;t||(C=V>0?Number.NEGATIVE_INFINITY:-(I+h*T),G=V>0?Number.NEGATIVE_INFINITY:-(I+I+h*T));for(_=V;_<Y;++_){var w,F=b[_],x=A[_];A[_]=C,w=(x+=k[_])>F?0:1,w=(x=x>F?x:F)>G?w:2,x=x>G?x:G,w=!t||x>0?w:64,C=x,M=q>x?M:_,q=q>x?q:x,x-=I,w|=(F-=h)>(x=!t||x>0?x:0)?4:0,F=F>x?F:x,b[_]=F,w|=(G-=h)>x?32:0,G=G>x?G:x,E[_]=w}A[Y]=C,b[Y]=t?0:Number.NEGATIVE_INFINITY,q>N&&(N=q,d=T,y=M)}if(t&&0==N)return null;function S(e,r,n){0==e.length||r!=(15&e[e.length-1])?e.push(n<<4|r):e[e.length-1]+=n<<4}p=t?N:A[s];var B,D,H=[],R=0,j=0;for(t?(T=d,D=y,y!=s-1&&S(H,4,s-1-y)):D=((T=l.length-1)+f+1<s?T+f+1:s)-1;T>=0&&D>=0&&!(0==(R=(B=m[T][D-(T>f?T-f:0)])>>(R<<1)&3)&&B>>6);)0==R&&(R=3&B),0==R?(S(H,0,1),--T,--D):1==R?(S(H,2,1),--T):(S(H,1,1),--D);t?(D>=0&&S(H,4,D+1),j=T+1):(T>=0&&S(H,2,T+1),D>=0&&S(H,1,D+1));for(T=0;T<H.length>>1;++T)B=H[T],H[T]=H[H.length-1-T],H[H.length-1-T]=B;return{score:p,position:j,CIGAR:H}},e.gen_score_matrix=function(e,r,n){var t=[];n>0&&(n=-n);for(var o=0;o<e-1;++o){t[o]=[];for(var a=0;a<e-1;++a)t[o][a]=o==a?r:n;t[o][a]=0}t[e-1]=[];for(a=0;a<e;++a)t[e-1][a]=0;return t},e.gen_query_profile=function(r,n,t){var o,a="string"==typeof r?e.bsg_enc_seq(r,t):r,f=[];if(n.length>=2&&"number"==typeof n[0]&&"number"==typeof n[1]){if(null==t)return null;var u="number"==typeof t?t:t[t.length-1]+1;o=e.gen_score_matrix(u,n[0],n[1])}else o=n;for(var l=0;l<o.length;++l){var i,s=o[l];i=f[l]=[];for(var g=0;g<a.length;++g)i[g]=s[a[g]]}return f},e.bsg_enc_seq=function(r,n){null==n&&(n=e.nt5);for(var t=new Array(r.length),o=0;o<r.length;++o)t[o]=n[r.charCodeAt(o)];return t},e.cigar2str=function(e){for(var r=[],n=0;n<e.length;++n)r.push((e[n]>>4).toString()+"MIDNSHP=XB".charAt(15&e[n]));return r.join()},e.cigar2gaps=function(e,r,n,t,o){for(var a="",f="",u=0,l=n,i=0;i<t.length;++i){var s=15&t[i],g=t[i]>>4;0==s?(a+=r.substr(u,g),f+=e.substr(l,g),u+=g,l+=g):1==s?(o||(a+=r.substr(u,g),f+="-".repeat(g)),u+=g):2==s?(a+="-".repeat(g),f+=e.substr(l,g),l+=g):4==s&&(u+=g)}return[f,a]},e}));
